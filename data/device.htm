<!DOCTYPE html>
<html lang="ru">
 <head>
  <meta http-equiv="Content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" href="/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="/style.css">
  <script type="text/javascript" src="/function.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Страница управления</title>
  <script type="text/javascript">
   function handleServerResponse(){
   }
   function sonoff(submit){
    server = "/sonoff";
    document.getElementById('url1').innerHTML='<a href="http://'+document.domain+':'+jsonResponse.DDNSPort+server+'" target="_blank">http://'+document.domain+':'+jsonResponse.DDNSPort+server+'</a>';
    if(navigator.onLine) {
     xhr = new XMLHttpRequest();
     xhr.open("GET","https://api.ipify.org?format=text",true);
     xhr.onload = function () {
      if (xhr.readyState === xhr.DONE) {
       if (xhr.status === 200) {
        document.getElementById('url2').innerHTML='<a href="http://'+(jsonResponse.DDNSName?(jsonResponse.DDNSName+':'+jsonResponse.DDNSPort+server):xhr.responseText+':'+jsonResponse.DDNSPort+server)+'" target="_blank">http://'+(jsonResponse.DDNSName?(jsonResponse.DDNSName+':'+jsonResponse.DDNSPort+server):xhr.responseText+':'+jsonResponse.DDNSPort+server)+'</a>';
       }
      }
     };
     xhr.send(null);
    }
    send_request(submit,server);
   }
   function set_time(submit){
    server = "/Timesonoff?t="+val('sonoff');
    send_request(submit,server);
   }
   function set_time1(submit){
    server = "/times1?time1="+val('time1');
    send_request(submit,server);
   }
   function set_time2(submit){
    server = "/times2?time2="+val('time2');
    send_request(submit,server);
   }
   function ddns(submit){
    server = "/ddns?url="+encodeURIComponent(val('ddns'))+"&wanurl="+val("ddns-name")+"&wanport="+val("ddns-port");
    send_request(submit,server);
   }
  </script>
  <style type="text/css">
   #set-time {
    z-index:111;
    background-color:#fff;
    box-shadow:0 12px 15px rgba(0, 0, 0, 0.4);
    padding:20px;
    margin-top:-45%;
    position:relative;
   }
  </style>
 </head>
 <body onload="load();">
  <div class="container">
   <div class="row" style="text-align:center;">
    <h1 style="margin:50px;">Страница управления</h1>
    <div class="col-sm-offset-2 col-sm-8 col-md-offset-3 col-md-6">
     <h5 class="alert-danger">{{SSDP}}</h5>
     <a class="btn btn-block btn-danger" href="/">Страница устройств</a>
     <a class="btn btn-block btn-default" href="/setup.htm">Доп. настройки</a>
     <hr>
     <div class="alert alert-dismissible alert-info">С помощью сервиса <a href="https://ifttt.com/myrecipes/personal" target="_blank">ifttt.com</a> Sonoff может включатся по множествам сценариев, например: новое сообщение в facebook, twitter, <a href="#" onclick="toggle('hide');return false">подробнее...</a><span id="hide" class="hidden">задания в Google calendar, почта и многое другое. Подробней о том как это сделать вы можете посмотреть видео <a href="https://youtu.be/3PVQYLQ-XDQ" target="_blank">здесь</a>.<strong><br>Локальная ссылка: <span id="url1"></span><br>Глобальная ссылка: <span id="url2"></span></strong></span>
     </div>
     <input class="btn btn-block btn-lg btn-primary" id="off-on" value="Включить\Выключить" onclick="sonoff(this);" type="submit">
     <hr>
     <h2>Таймеры</h2>
     <div class="row">
      <div class="col-sm-6">
       <h4>Таймер 1:</h4>
       <input id="time1" value="{{times1}}" pattern="(0[0-9]|1[0-9]|2[0-3])(:[0-5][0-9]){2}" class="form-control">
       <div class="btn-group" style="width:100%;">
        <input class="btn btn-success" style="width:70%;" value="Сохранить" onclick="set_time1(this);" type="submit">
        <input class="btn btn-default" style="width:30%;" value="Выкл." onclick="document.getElementById('time1').value='';set_time1(this);" type="submit">
       </div>
       <h4>Таймер 2:</h4>
       <input id="time2" value="{{times2}}" pattern="(0[0-9]|1[0-9]|2[0-3])(:[0-5][0-9]){2}" class="form-control">
       <div class="btn-group" style="width:100%;">
        <input class="btn btn-success" style="width:70%;" value="Сохранить" onclick="set_time2(this);" type="submit">
        <input class="btn btn-default" style="width:30%;" value="Выкл." onclick="document.getElementById('time2').value='';set_time2(this);" type="submit">
       </div>
      </div>
      <div class="col-sm-6">
       <div class="alert alert-dismissible alert-warning"><b>Обратите внимание</b> Настраивая время перед одиночными цифрами пишите 0. Пример: 03:09:10.
        Таймер будит повторять включение каждый день.</div>
       <div class="alert alert-dismissible alert-info">
        Больше настроек вы можете получить на <a href="https://ifttt.com/create/if-date_and_time?sid=1" target="_blank">ifttt.com</a>.
       </div>
      </div>
     </div>
     <div class="row">
      <h2>Время работы таймера</h2>
      <div class="col-sm-8">
       <div class="alert alert-dismissible alert-info">Здесь указается время в секундах как долго будет работать реле.</div>
      </div>
      <div class="col-sm-4">
       <div class="input-group">
        <input id="sonoff" value="{{timesonoff}}" class="form-control" pattern="[0-9]*[.,]?[0-9]+">
        <span class="input-group-addon">сек.</span>
       </div>
       <input class="btn btn-block btn-success" value="Сохранить" onclick="set_time(this);" type="submit">
      </div>
     </div>
     <hr>
     <h2>Dynamic DNS</h2>
     <div class="alert alert-dismissible alert-info">В 15, 30, 45 минут каждого часа устройство переходить по ссылке. Вы можете воспользоваться <a href="http://dyndns.dk" target="_blank">dyndns.dk</a> и таким образом сделать себе домен на динамическом IP. Что позволит комфортно пользоваться <a href="https://ifttt.com" target="_blank">ifttt.com</a></div>
     <div class="input-group" style="width:100%;">
      <input id="ddns-name" value="{{DDNSName}}" class="form-control" style="width:70%;display:inline" placeholder="Host name">
      <input id="ddns-port" value="{{DDNSPort}}" class="form-control" style="width:30%;display:inline" pattern="[0-9]+" placeholder="Host port">
     </div>
     <input id="ddns" value="{{DDNS}}" class="form-control" pattern="http://.+" placeholder="Service URL">
     <input class="btn btn-block btn-success" value="Сохранить" onclick="ddns(this);" type="submit">
     <hr>
     <a class="btn btn-block btn-default" href="/setup.htm">Доп. настройки</a>
    </div>
   </div>
  </div>
 </body>
</html>
