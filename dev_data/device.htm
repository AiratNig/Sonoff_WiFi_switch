<!DOCTYPE html>
<html>
 <head>
  <meta http-equiv="Content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" type="text/css" href="css/build.css">
  <!-- <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="css/style.css"> -->
  <link rel="stylesheet" type="text/css" href="css/chartist.min.css">
  <script src="js/chartist.min.js" charset="utf-8"></script>
  <script type="text/javascript" src="js/function.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Options page</title>
  <script type="text/javascript">
   var myVar;
   function handleServerResponse(stage,jsonResponse){
    if (jsonResponse.state=='0') {blockval=jsonResponse.LangOn;} else {blockval=jsonResponse.LangOff;}
    val('off-on', blockval);

    if (stage != 'next') {
     function viewTime() {
      var now = new Date();
      return now.getHours()+':'+now.getMinutes()+':'+now.getSeconds();
     }
     function adddata() {
      var xmlHttp=createXmlHttpObject();
      xmlHttp.open("GET", "/sensor.json", true);
      xmlHttp.send(null);
      xmlHttp.onload = function(e) {
       var Module=JSON.parse(xmlHttp.responseText);
       if (Module[0].Temperature != 'hidden') {
        LineChart.data.series[0].shift();
        LineChart.data.series[0].push(Module[0].Temperature);
        if (Module[0].Humidity != 'hidden') {
         LineChart.data.series[1].shift();
         LineChart.data.series[1].push(Module[0].Humidity);
        }
        LineChart.data.labels.shift();
        LineChart.data.labels.push(viewTime());
        LineChart.update();
       }
       var e = document.getElementById("refresh-time");
       var strUser = e.options[e.selectedIndex].value;
       clearInterval(myVar);
       myVar=setInterval(function(){adddata();}, strUser);
      }
     }
     var LineChart = Chartist.Line('.ct-chart', {
      labels: [, , , , , , , , , , ],
      series: [[, , , , , , , , , , ],[, , , , , , , , , , ]]
     }, {fullWidth:true});
     adddata();
    }
   }
   function sonoff(submit){
    server = "/sonoff";
    document.getElementById('url1').innerHTML='<a href="http://'+document.domain+server+'" target="_blank">http://'+document.domain+server+'<\/a>';
    if(navigator.onLine) {
     xhr = new XMLHttpRequest();
     xhr.open("GET","https://api.ipify.org?format=text",true);
     xhr.onload = function () {
      if (xhr.readyState === xhr.DONE) {
       if (xhr.status === 200) {
        document.getElementById('url2').innerHTML='<a href="http://'+(jsonResponse.DDNSName?(jsonResponse.DDNSName+':'+jsonResponse.DDNSPort+server):xhr.responseText+':'+jsonResponse.DDNSPort+server)+'" target="_blank">http://'+(jsonResponse.DDNSName?(jsonResponse.DDNSName+':'+jsonResponse.DDNSPort+server):xhr.responseText+':'+jsonResponse.DDNSPort+server)+'<\/a>';
       }
      }
     };
     xhr.send(null);
    }
    send_request(submit,server);
   }
   function set_time1(submit){
    send_request(submit,'/times1?time1='+val('time1'));
   }
   function set_time2(submit){
    send_request(submit,'/times2?time2='+val('time2'));
   }
  </script>
  <style>.ct-label{font-size:10px;}</style>
 </head>
 <body onload="load('first');">
  <div class="container">
   <div class="row hidden" id="content">
    <h1 id="title">{{LangOptions1}}</h1>
    <div class="col-sm-offset-2 col-sm-8 col-md-offset-3 col-md-6">
     <h5 class="alert-danger">{{SSDP}}</h5>
     <div class="btn-group" id="language">
      <a href="#" class="btn btn-default dropdown-toggle" onclick="toggle('language-set');LoadLang('language-set');return false">{{lang}} <span class="caret"></span></a>
      <ul class="dropdown-menu hidden" id="language-set"><li><a href="#">{{LangLoading}}</a></li></ul>
     </div>
     <a class="btn btn-block btn-danger" href="/">{{LangDevices}}</a>
     <a class="btn btn-block btn-default" href="/setup.htm">{{LangSetting3}}</a>
     <hr>
     <div class="alert alert-dismissible alert-info {{g2342}}"><button class="close" onclick="setCookie('g2342','hidden',365,this);" type="button">×</button>{{LangIfttt1}}<span id="hide" class="hidden">{{LangIfttt2}}</span></div>
     <div class="{{Temperature}}" id="sensors">
      <div class="ct-chart" style="height:200px"></div>
      <select class="form-control" id="refresh-time">
       <option value="1000">1 {{LangSec}}</option>
       <option value="5000" selected>5 {{LangSec}}</option>
       <option value="30000">30 {{LangSec}}</option>
       <option value="60000">60 {{LangSec}}</option>
      </select>
      <span id="humidity" class="hidden"></span>
     </div>
     <hr>
     <input class="btn btn-block btn-lg btn-primary" id="off-on" value="{{LangOnOff}}" onclick="sonoff(this);" type="button">
     <hr>
     <h2>{{LangTimer1}}</h2>
     <div class="row">
      <div class="col-sm-6">
       <h4>{{LangTimer2}} 1:</h4>
       <input id="time1" value="{{times1}}" pattern="(0[0-9]|1[0-9]|2[0-3])(:[0-5][0-9]){2}" class="form-control" placeholder="{{LangExample}}: 07:10:30">
       <div class="btn-group" style="width:100%">
        <input class="btn btn-success" style="width:70%" value="{{LangSave}}" onclick="set_time1(this);" type="button">
        <input class="btn btn-default" style="width:30%" value="{{LangOff.}}" onclick="val('time1',' ');set_time1(this);" type="button">
       </div>
       <h4>{{LangTimer2}} 2:</h4>
       <input id="time2" value="{{times2}}" pattern="(0[0-9]|1[0-9]|2[0-3])(:[0-5][0-9]){2}" class="form-control" placeholder="{{LangExample}}: 07:10:30">
       <div class="btn-group" style="width:100%">
        <input class="btn btn-success" style="width:70%" value="{{LangSave}}" onclick="set_time2(this);" type="button">
        <input class="btn btn-default" style="width:30%" value="{{LangOff.}}" onclick="val('time2',' ');set_time2(this);" type="button">
       </div>
      </div>
      <div class="col-sm-6">
       <div class="alert alert-dismissible alert-warning">{{LangTime6}}</div>
       <div class="alert alert-dismissible alert-info {{g2532}}"><button class="close" onclick="setCookie('g2532','hidden',365,this);" type="button">×</button>
        {{LangIfttt3}}
       </div>
      </div>
     </div>
     <div class="row">
      <h2>{{LangTime3}}</h2>
      <div class="col-sm-8">
       <div class="alert alert-dismissible alert-info">{{LangTime4}}</div>
      </div>
      <div class="col-sm-4">
       <div class="input-group">
        <input id="sonoff" value="{{timesonoff}}" class="form-control" pattern="[0-9]*[.,]?[0-9]+">
        <span class="input-group-addon">{{LangMin}}</span>
       </div>
       <input class="btn btn-block btn-success" value="{{LangSave}}" onclick="send_request(this,'/Timesonoff?t='+val('sonoff'));" type="button">
      </div>
     </div>
     <hr>
     <a class="btn btn-block btn-default" href="/setup.htm">{{LangSetting3}}</a>
    </div>
   </div>
  </div>
 </body>
</html>
